#!/bin/sh

set -o errexit
set -o pipefail
set -o nounset




if [ -z "${POSTGRES_USER}" ]; then
    base_postgres_image_default_user='postgres'
    export POSTGRES_USER="${base_postgres_image_default_user}"
fi
export DATABASE_URL="postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}"

# Download spaCy model if not already present
# This allows users to specify a different model via SPACY_MODEL env var
SPACY_MODEL="${SPACY_MODEL:-en_core_web_sm}"
if ! python -c "import spacy; spacy.load('${SPACY_MODEL}')" 2>/dev/null; then
    echo "Downloading spaCy model: ${SPACY_MODEL}"
    python -m spacy download "${SPACY_MODEL}"
fi

exec "$@"
